{"version":3,"file":"api-DufEv4lH.js","sources":["../../src/utils/api.ts"],"sourcesContent":["import axios, {\r\n  type InternalAxiosRequestConfig,\r\n  type AxiosResponse,\r\n  type AxiosError,\r\n} from \"axios\";\r\nimport { loading } from \"./loading\";\r\nimport { notify } from \"./notify\";\r\n\r\nconst api = axios.create({\r\n  baseURL: import.meta.env.VITE_API_BASE_URL || \"/api\",\r\n  timeout: 30000,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\nfunction addAuthTokenToRequest(config: InternalAxiosRequestConfig) {\r\n  const token = localStorage.getItem(\"auth_token\");\r\n  if (token && config.headers) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n}\r\n\r\nfunction showLoadingForMutations(config: InternalAxiosRequestConfig) {\r\n  if (config.method !== \"get\") {\r\n    loading(true, \"Processing...\");\r\n  }\r\n}\r\n\r\napi.interceptors.request.use(\r\n  (config: InternalAxiosRequestConfig) => {\r\n    addAuthTokenToRequest(config);\r\n    showLoadingForMutations(config);\r\n    return config;\r\n  },\r\n  (error: AxiosError) => {\r\n    loading(false);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nfunction handleUnauthorized() {\r\n  notify(\"error\", \"Unauthorized\", \"Please log in again\");\r\n  localStorage.removeItem(\"auth_token\");\r\n  window.location.href = \"/login\";\r\n}\r\n\r\nfunction handleErrorResponse(error: AxiosError) {\r\n  if (!error.response) {\r\n    if (error.request) {\r\n      notify(\"error\", \"Network Error\", \"Unable to connect to the server\");\r\n    } else {\r\n      notify(\"error\", \"Error\", error.message);\r\n    }\r\n    return;\r\n  }\r\n\r\n  const status = error.response.status;\r\n  const message = (error.response.data as any)?.message || \"An error occurred\";\r\n\r\n  switch (status) {\r\n    case 401:\r\n      handleUnauthorized();\r\n      break;\r\n    case 403:\r\n      notify(\r\n        \"error\",\r\n        \"Forbidden\",\r\n        \"You do not have permission to perform this action\"\r\n      );\r\n      break;\r\n    case 404:\r\n      notify(\"error\", \"Not Found\", \"The requested resource was not found\");\r\n      break;\r\n    case 500:\r\n      notify(\r\n        \"error\",\r\n        \"Server Error\",\r\n        \"Internal server error. Please try again later.\"\r\n      );\r\n      break;\r\n    default:\r\n      notify(\"error\", \"Error\", message);\r\n  }\r\n}\r\n\r\napi.interceptors.response.use(\r\n  (response: AxiosResponse) => {\r\n    loading(false);\r\n    return response;\r\n  },\r\n  (error: AxiosError) => {\r\n    loading(false);\r\n    handleErrorResponse(error);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n"],"names":["api","axios","addAuthTokenToRequest","config","token","showLoadingForMutations","loading","error","handleUnauthorized","notify","handleErrorResponse","status","message","response"],"mappings":";;AAQA,MAAMA,IAAMC,EAAM,OAAO;AAAA,EACvB,SAA8C;AAAA,EAC9C,SAAS;AAAA,EACT,SAAS;AAAA,IACP,gBAAgB;AAAA,EAAA;AAEpB,CAAC;AAED,SAASC,EAAsBC,GAAoC;AACjE,QAAMC,IAAQ,aAAa,QAAQ,YAAY;AAC/C,SAAIA,KAASD,EAAO,YAClBA,EAAO,QAAQ,gBAAgB,UAAUC,CAAK,KAEzCD;AACT;AAEA,SAASE,EAAwBF,GAAoC;AACnE,EAAIA,EAAO,WAAW,SACpBG,EAAQ,IAAM,eAAe;AAEjC;AAEAN,EAAI,aAAa,QAAQ;AAAA,EACvB,CAACG,OACCD,EAAsBC,CAAM,GAC5BE,EAAwBF,CAAM,GACvBA;AAAA,EAET,CAACI,OACCD,EAAQ,EAAK,GACN,QAAQ,OAAOC,CAAK;AAE/B;AAEA,SAASC,IAAqB;AAC5B,EAAAC,EAAO,SAAS,gBAAgB,qBAAqB,GACrD,aAAa,WAAW,YAAY,GACpC,OAAO,SAAS,OAAO;AACzB;AAEA,SAASC,EAAoBH,GAAmB;AAC9C,MAAI,CAACA,EAAM,UAAU;AACnB,IAAIA,EAAM,UACRE,EAAO,SAAS,iBAAiB,iCAAiC,IAElEA,EAAO,SAAS,SAASF,EAAM,OAAO;AAExC;AAAA,EACF;AAEA,QAAMI,IAASJ,EAAM,SAAS,QACxBK,IAAWL,EAAM,SAAS,MAAc,WAAW;AAEzD,UAAQI,GAAA;AAAA,IACN,KAAK;AACH,MAAAH,EAAA;AACA;AAAA,IACF,KAAK;AACH,MAAAC;AAAA,QACE;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAEF;AAAA,IACF,KAAK;AACH,MAAAA,EAAO,SAAS,aAAa,sCAAsC;AACnE;AAAA,IACF,KAAK;AACH,MAAAA;AAAA,QACE;AAAA,QACA;AAAA,QACA;AAAA,MAAA;AAEF;AAAA,IACF;AACE,MAAAA,EAAO,SAAS,SAASG,CAAO;AAAA,EAAA;AAEtC;AAEAZ,EAAI,aAAa,SAAS;AAAA,EACxB,CAACa,OACCP,EAAQ,EAAK,GACNO;AAAA,EAET,CAACN,OACCD,EAAQ,EAAK,GACbI,EAAoBH,CAAK,GAClB,QAAQ,OAAOA,CAAK;AAE/B;"}