{"version":3,"file":"inputs-MoneyField-BXA_jpq-.js","sources":["../../../src/components/inputs/MoneyField.vue"],"sourcesContent":["<template>\r\n  <v-text-field\r\n    :model-value=\"formattedValue\"\r\n    @update:model-value=\"handleInput\"\r\n    :label=\"label\"\r\n    :rules=\"rules\"\r\n    :disabled=\"disabled\"\r\n    :hint=\"hint\"\r\n    :persistent-hint=\"persistentHint\"\r\n    :variant=\"variant\"\r\n    @focus=\"handleFocus\"\r\n    @click=\"handleClick\"\r\n    @keydown=\"handleKeydown\"\r\n    inputmode=\"decimal\"\r\n  >\r\n    <template v-if=\"$slots.prepend\" #prepend>\r\n      <slot name=\"prepend\" />\r\n    </template>\r\n    <template v-if=\"$slots.append\" #append>\r\n      <slot name=\"append\" />\r\n    </template>\r\n  </v-text-field>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, watch, nextTick } from 'vue';\r\n\r\ninterface Props {\r\n  modelValue?: number | null;\r\n  label?: string;\r\n  rules?: any[];\r\n  disabled?: boolean;\r\n  hint?: string;\r\n  persistentHint?: boolean;\r\n  currency?: string;\r\n  locale?: string;\r\n  variant?: 'outlined' | 'filled' | 'plain' | 'solo' | 'solo-filled' | 'solo-inverted' | 'underlined';\r\n}\r\n\r\nconst props = withDefaults(defineProps<Props>(), {\r\n  modelValue: 0,\r\n  label: '',\r\n  rules: () => [],\r\n  disabled: false,\r\n  hint: '',\r\n  persistentHint: false,\r\n  currency: 'BRL',\r\n  locale: 'pt-BR',\r\n  variant: 'underlined'\r\n});\r\n\r\nconst emit = defineEmits<{\r\n  'update:modelValue': [value: number];\r\n}>();\r\n\r\nconst formattedValue = ref('R$ 0,00');\r\n\r\nfunction formatMoney(value: number): string {\r\n  const absValue = Math.abs(value);\r\n  const currencySymbol = getCurrencySymbol();\r\n  \r\n  const formatted = absValue.toLocaleString(props.locale, {\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2\r\n  });\r\n  \r\n  return value < 0 ? `-${currencySymbol} ${formatted}` : `${currencySymbol} ${formatted}`;\r\n}\r\n\r\nfunction getCurrencySymbol(): string {\r\n  const symbols: Record<string, string> = {\r\n    'BRL': 'R$',\r\n    'USD': '$',\r\n    'EUR': '€',\r\n    'GBP': '£'\r\n  };\r\n  return symbols[props.currency] || props.currency;\r\n}\r\n\r\nfunction parseMoneyInput(input: string): number {\r\n  const isNegative = input.includes('-');\r\n  const numbers = input.replace(/\\D/g, '');\r\n  \r\n  if (!numbers) return 0;\r\n  \r\n  const value = parseInt(numbers) / 100;\r\n  const rounded = Number((isNegative ? -value : value).toFixed(2));\r\n  \r\n  return rounded;\r\n}\r\n\r\nfunction handleInput(value: string) {\r\n  const numericValue = parseMoneyInput(value);\r\n  emit('update:modelValue', numericValue);\r\n  \r\n  // Força a atualização da formatação após o emit\r\n  nextTick(() => {\r\n    formattedValue.value = formatMoney(numericValue);\r\n  });\r\n}\r\n\r\nfunction handleFocus(event: FocusEvent) {\r\n  const input = event.target as HTMLInputElement;\r\n  nextTick(() => {\r\n    // Posiciona o cursor no final do campo\r\n    input.setSelectionRange(input.value.length, input.value.length);\r\n  });\r\n}\r\n\r\nfunction handleClick(event: MouseEvent) {\r\n  const input = event.target as HTMLInputElement;\r\n  nextTick(() => {\r\n    // Posiciona o cursor no final do campo\r\n    input.setSelectionRange(input.value.length, input.value.length);\r\n  });\r\n}\r\n\r\nfunction handleKeydown(event: KeyboardEvent) {\r\n  const input = event.target as HTMLInputElement;\r\n  const currentValue = formattedValue.value;\r\n  \r\n  // Permite teclas de navegação e controle\r\n  const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Home', 'End'];\r\n  \r\n  if (allowedKeys.includes(event.key) || event.ctrlKey || event.metaKey) {\r\n    if (event.key === 'Backspace' || event.key === 'Delete') {\r\n      event.preventDefault();\r\n      \r\n      // Extrai apenas os números do valor atual\r\n      const numbers = currentValue.replace(/\\D/g, '');\r\n      \r\n      if (numbers.length > 0) {\r\n        // Remove o último dígito\r\n        const newNumbers = numbers.slice(0, -1);\r\n        const newValue = newNumbers ? parseInt(newNumbers) / 100 : 0;\r\n        \r\n        emit('update:modelValue', newValue);\r\n        formattedValue.value = formatMoney(newValue);\r\n        \r\n        // Mantém o cursor no final\r\n        nextTick(() => {\r\n          input.setSelectionRange(input.value.length, input.value.length);\r\n        });\r\n      }\r\n    }\r\n    return;\r\n  }\r\n  \r\n  // Permite apenas números e sinal de menos\r\n  if (!/[\\d-]/.test(event.key)) {\r\n    event.preventDefault();\r\n    return;\r\n  }\r\n  \r\n  // Previne o comportamento padrão para processar manualmente\r\n  event.preventDefault();\r\n  \r\n  if (event.key === '-') {\r\n    // Inverte o sinal\r\n    const currentNumeric = parseMoneyInput(currentValue);\r\n    const newValue = -currentNumeric;\r\n    emit('update:modelValue', newValue);\r\n    formattedValue.value = formatMoney(newValue);\r\n  } else {\r\n    // Adiciona o novo dígito\r\n    const numbers = currentValue.replace(/\\D/g, '');\r\n    const newNumbers = numbers + event.key;\r\n    const newValue = parseInt(newNumbers) / 100;\r\n    \r\n    emit('update:modelValue', newValue);\r\n    formattedValue.value = formatMoney(newValue);\r\n  }\r\n  \r\n  // Mantém o cursor no final\r\n  nextTick(() => {\r\n    input.setSelectionRange(input.value.length, input.value.length);\r\n  });\r\n}\r\n\r\nwatch(\r\n  () => props.modelValue,\r\n  (newVal) => {\r\n    const value = newVal ?? 0;\r\n    formattedValue.value = formatMoney(value);\r\n  },\r\n  { immediate: true }\r\n);\r\n</script>\r\n\r\n<style scoped>\r\n:deep(input) {\r\n  text-align: right;\r\n}\r\n</style>\r\n"],"names":["props","__props","emit","__emit","formattedValue","ref","formatMoney","value","absValue","currencySymbol","getCurrencySymbol","formatted","parseMoneyInput","input","isNegative","numbers","handleInput","numericValue","nextTick","handleFocus","event","handleClick","handleKeydown","currentValue","newNumbers","newValue","watch","newVal","_createBlock","_component_v_text_field","$slots","_renderSlot","_ctx"],"mappings":"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"}