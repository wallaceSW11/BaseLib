{"version":3,"file":"api-BsR2dtOX.js","sources":["../../src/utils/api.ts"],"sourcesContent":["import axios, {\r\n  type InternalAxiosRequestConfig,\r\n  type AxiosResponse,\r\n  type AxiosError,\r\n} from \"axios\";\r\nimport { loading } from \"./loading\";\r\nimport { notify } from \"./notify\";\r\nimport { API_TIMEOUT } from \"./types\";\r\n\r\nexport interface ApiConfig {\r\n  baseURL?: string;\r\n  timeout?: number;\r\n  showLoadingOnMutations?: boolean;\r\n  showErrorNotifications?: boolean;\r\n  authTokenKey?: string;\r\n  onUnauthorized?: () => void;\r\n}\r\n\r\nconst defaultConfig: ApiConfig = {\r\n  baseURL: import.meta.env.VITE_API_BASE_URL || \"/api\",\r\n  timeout: API_TIMEOUT,\r\n  showLoadingOnMutations: true,\r\n  showErrorNotifications: true,\r\n  authTokenKey: \"auth_token\",\r\n  onUnauthorized: () => {\r\n    localStorage.removeItem(\"auth_token\");\r\n    window.location.href = \"/login\";\r\n  },\r\n};\r\n\r\nlet currentConfig = { ...defaultConfig };\r\n\r\nconst api = axios.create({\r\n  baseURL: currentConfig.baseURL,\r\n  timeout: currentConfig.timeout,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\nexport function configureApi(config: Partial<ApiConfig>) {\r\n  currentConfig = { ...currentConfig, ...config };\r\n  \r\n  if (config.baseURL) {\r\n    api.defaults.baseURL = config.baseURL;\r\n  }\r\n  if (config.timeout) {\r\n    api.defaults.timeout = config.timeout;\r\n  }\r\n}\r\n\r\nfunction addAuthTokenToRequest(config: InternalAxiosRequestConfig) {\r\n  const token = localStorage.getItem(currentConfig.authTokenKey!);\r\n  if (token && config.headers) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n}\r\n\r\nfunction showLoadingForMutations(config: InternalAxiosRequestConfig) {\r\n  if (currentConfig.showLoadingOnMutations && config.method !== \"get\") {\r\n    loading.show(\"Processing...\");\r\n  }\r\n}\r\n\r\napi.interceptors.request.use(\r\n  (config: InternalAxiosRequestConfig) => {\r\n    addAuthTokenToRequest(config);\r\n    showLoadingForMutations(config);\r\n    return config;\r\n  },\r\n  (error: AxiosError) => {\r\n    loading.hide();\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nfunction handleUnauthorized() {\r\n  if (currentConfig.showErrorNotifications) {\r\n    notify.error(\"Unauthorized\", \"Please log in again\");\r\n  }\r\n  if (currentConfig.onUnauthorized) {\r\n    currentConfig.onUnauthorized();\r\n  }\r\n}\r\n\r\nfunction handleErrorResponse(error: AxiosError) {\r\n  if (!currentConfig.showErrorNotifications) {\r\n    return;\r\n  }\r\n\r\n  if (!error.response) {\r\n    if (error.request) {\r\n      notify.error(\"Network Error\", \"Unable to connect to the server\");\r\n    } else {\r\n      notify.error(\"Error\", error.message);\r\n    }\r\n    return;\r\n  }\r\n\r\n  const status = error.response.status;\r\n  const message = (error.response.data as any)?.message || \"An error occurred\";\r\n\r\n  switch (status) {\r\n    case 401:\r\n      handleUnauthorized();\r\n      break;\r\n    case 403:\r\n      notify.error(\r\n        \"Forbidden\",\r\n        \"You do not have permission to perform this action\"\r\n      );\r\n      break;\r\n    case 404:\r\n      notify.error(\"Not Found\", \"The requested resource was not found\");\r\n      break;\r\n    case 500:\r\n      notify.error(\r\n        \"Server Error\",\r\n        \"Internal server error. Please try again later.\"\r\n      );\r\n      break;\r\n    default:\r\n      notify.error(\"Error\", message);\r\n  }\r\n}\r\n\r\napi.interceptors.response.use(\r\n  (response: AxiosResponse) => {\r\n    loading.hide();\r\n    return response;\r\n  },\r\n  (error: AxiosError) => {\r\n    loading.hide();\r\n    handleErrorResponse(error);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n"],"names":["defaultConfig","API_TIMEOUT","currentConfig","api","axios","addAuthTokenToRequest","config","token","showLoadingForMutations","loading","error","handleUnauthorized","notify","handleErrorResponse","status","message","response"],"mappings":";;;AAkBA,MAAMA,IAA2B;AAAA,EAC/B,SAA8C;AAAA,EAC9C,SAASC;AAAA,EACT,wBAAwB;AAAA,EACxB,wBAAwB;AAAA,EACxB,cAAc;AAAA,EACd,gBAAgB,MAAM;AACpB,iBAAa,WAAW,YAAY,GACpC,OAAO,SAAS,OAAO;AAAA,EACzB;AACF;AAEA,IAAIC,IAAgB,EAAE,GAAGF,EAAA;AAEzB,MAAMG,IAAMC,EAAM,OAAO;AAAA,EACvB,SAASF,EAAc;AAAA,EACvB,SAASA,EAAc;AAAA,EACvB,SAAS;AAAA,IACP,gBAAgB;AAAA,EAAA;AAEpB,CAAC;AAaD,SAASG,EAAsBC,GAAoC;AACjE,QAAMC,IAAQ,aAAa,QAAQL,EAAc,YAAa;AAC9D,SAAIK,KAASD,EAAO,YAClBA,EAAO,QAAQ,gBAAgB,UAAUC,CAAK,KAEzCD;AACT;AAEA,SAASE,EAAwBF,GAAoC;AACnE,EAAIJ,EAAc,0BAA0BI,EAAO,WAAW,SAC5DG,EAAQ,KAAK,eAAe;AAEhC;AAEAN,EAAI,aAAa,QAAQ;AAAA,EACvB,CAACG,OACCD,EAAsBC,CAAM,GAC5BE,EAAwBF,CAAM,GACvBA;AAAA,EAET,CAACI,OACCD,EAAQ,KAAA,GACD,QAAQ,OAAOC,CAAK;AAE/B;AAEA,SAASC,IAAqB;AAC5B,EAAIT,EAAc,0BAChBU,EAAO,MAAM,gBAAgB,qBAAqB,GAEhDV,EAAc,kBAChBA,EAAc,eAAA;AAElB;AAEA,SAASW,EAAoBH,GAAmB;AAC9C,MAAI,CAACR,EAAc;AACjB;AAGF,MAAI,CAACQ,EAAM,UAAU;AACnB,IAAIA,EAAM,UACRE,EAAO,MAAM,iBAAiB,iCAAiC,IAE/DA,EAAO,MAAM,SAASF,EAAM,OAAO;AAErC;AAAA,EACF;AAEA,QAAMI,IAASJ,EAAM,SAAS,QACxBK,IAAWL,EAAM,SAAS,MAAc,WAAW;AAEzD,UAAQI,GAAA;AAAA,IACN,KAAK;AACH,MAAAH,EAAA;AACA;AAAA,IACF,KAAK;AACH,MAAAC,EAAO;AAAA,QACL;AAAA,QACA;AAAA,MAAA;AAEF;AAAA,IACF,KAAK;AACH,MAAAA,EAAO,MAAM,aAAa,sCAAsC;AAChE;AAAA,IACF,KAAK;AACH,MAAAA,EAAO;AAAA,QACL;AAAA,QACA;AAAA,MAAA;AAEF;AAAA,IACF;AACE,MAAAA,EAAO,MAAM,SAASG,CAAO;AAAA,EAAA;AAEnC;AAEAZ,EAAI,aAAa,SAAS;AAAA,EACxB,CAACa,OACCP,EAAQ,KAAA,GACDO;AAAA,EAET,CAACN,OACCD,EAAQ,KAAA,GACRI,EAAoBH,CAAK,GAClB,QAAQ,OAAOA,CAAK;AAE/B;"}