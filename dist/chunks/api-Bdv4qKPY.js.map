{"version":3,"file":"api-Bdv4qKPY.js","sources":["../../src/utils/api.ts"],"sourcesContent":["import axios, {\r\n  type InternalAxiosRequestConfig,\r\n  type AxiosResponse,\r\n  type AxiosError,\r\n} from \"axios\";\r\nimport { loading } from \"./loading\";\r\nimport { notify } from \"./notify\";\r\n\r\nconst api = axios.create({\r\n  baseURL: import.meta.env.VITE_API_BASE_URL || \"/api\",\r\n  timeout: 30000,\r\n  headers: {\r\n    \"Content-Type\": \"application/json\",\r\n  },\r\n});\r\n\r\nfunction addAuthTokenToRequest(config: InternalAxiosRequestConfig) {\r\n  const token = localStorage.getItem(\"auth_token\");\r\n  if (token && config.headers) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n}\r\n\r\nfunction showLoadingForMutations(config: InternalAxiosRequestConfig) {\r\n  if (config.method !== \"get\") {\r\n    loading(true, \"Processing...\");\r\n  }\r\n}\r\n\r\napi.interceptors.request.use(\r\n  (config: InternalAxiosRequestConfig) => {\r\n    addAuthTokenToRequest(config);\r\n    showLoadingForMutations(config);\r\n    return config;\r\n  },\r\n  (error: AxiosError) => {\r\n    loading(false);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nfunction handleUnauthorized() {\r\n  notify(\"error\", \"Unauthorized\", \"Please log in again\");\r\n  localStorage.removeItem(\"auth_token\");\r\n  window.location.href = \"/login\";\r\n}\r\n\r\nfunction handleErrorResponse(error: AxiosError) {\r\n  if (!error.response) {\r\n    if (error.request) {\r\n      notify(\"error\", \"Network Error\", \"Unable to connect to the server\");\r\n    } else {\r\n      notify(\"error\", \"Error\", error.message);\r\n    }\r\n    return;\r\n  }\r\n\r\n  const status = error.response.status;\r\n  const message = (error.response.data as any)?.message || \"An error occurred\";\r\n\r\n  switch (status) {\r\n    case 401:\r\n      handleUnauthorized();\r\n      break;\r\n    case 403:\r\n      notify(\r\n        \"error\",\r\n        \"Forbidden\",\r\n        \"You do not have permission to perform this action\"\r\n      );\r\n      break;\r\n    case 404:\r\n      notify(\"error\", \"Not Found\", \"The requested resource was not found\");\r\n      break;\r\n    case 500:\r\n      notify(\r\n        \"error\",\r\n        \"Server Error\",\r\n        \"Internal server error. Please try again later.\"\r\n      );\r\n      break;\r\n    default:\r\n      notify(\"error\", \"Error\", message);\r\n  }\r\n}\r\n\r\napi.interceptors.response.use(\r\n  (response: AxiosResponse) => {\r\n    loading(false);\r\n    return response;\r\n  },\r\n  (error: AxiosError) => {\r\n    loading(false);\r\n    handleErrorResponse(error);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport default api;\r\n"],"names":["api","axios","addAuthTokenToRequest","config","token","showLoadingForMutations","loading","error","handleUnauthorized","notify","handleErrorResponse","status","message","response"],"mappings":"yEAQMA,EAAMC,EAAM,OAAO,CACvB,QAA8C,OAC9C,QAAS,IACT,QAAS,CACP,eAAgB,kBAAA,CAEpB,CAAC,EAED,SAASC,EAAsBC,EAAoC,CACjE,MAAMC,EAAQ,aAAa,QAAQ,YAAY,EAC/C,OAAIA,GAASD,EAAO,UAClBA,EAAO,QAAQ,cAAgB,UAAUC,CAAK,IAEzCD,CACT,CAEA,SAASE,EAAwBF,EAAoC,CAC/DA,EAAO,SAAW,OACpBG,EAAAA,QAAQ,GAAM,eAAe,CAEjC,CAEAN,EAAI,aAAa,QAAQ,IACtBG,IACCD,EAAsBC,CAAM,EAC5BE,EAAwBF,CAAM,EACvBA,GAERI,IACCD,EAAAA,QAAQ,EAAK,EACN,QAAQ,OAAOC,CAAK,EAE/B,EAEA,SAASC,GAAqB,CAC5BC,SAAO,QAAS,eAAgB,qBAAqB,EACrD,aAAa,WAAW,YAAY,EACpC,OAAO,SAAS,KAAO,QACzB,CAEA,SAASC,EAAoBH,EAAmB,CAC9C,GAAI,CAACA,EAAM,SAAU,CACfA,EAAM,QACRE,SAAO,QAAS,gBAAiB,iCAAiC,EAElEA,EAAAA,OAAO,QAAS,QAASF,EAAM,OAAO,EAExC,MACF,CAEA,MAAMI,EAASJ,EAAM,SAAS,OACxBK,EAAWL,EAAM,SAAS,MAAc,SAAW,oBAEzD,OAAQI,EAAA,CACN,IAAK,KACHH,EAAA,EACA,MACF,IAAK,KACHC,EAAAA,OACE,QACA,YACA,mDAAA,EAEF,MACF,IAAK,KACHA,SAAO,QAAS,YAAa,sCAAsC,EACnE,MACF,IAAK,KACHA,EAAAA,OACE,QACA,eACA,gDAAA,EAEF,MACF,QACEA,SAAO,QAAS,QAASG,CAAO,CAAA,CAEtC,CAEAZ,EAAI,aAAa,SAAS,IACvBa,IACCP,EAAAA,QAAQ,EAAK,EACNO,GAERN,IACCD,EAAAA,QAAQ,EAAK,EACbI,EAAoBH,CAAK,EAClB,QAAQ,OAAOA,CAAK,EAE/B"}